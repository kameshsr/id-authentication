-- ------------------------------------------------------------------------------------------
-- Rollback script for Reverting Spring Batch version upgrade changes.
-- ------------------------------------------------------------------------------------------

-- Reverse the addition of the CREATE_TIME column
ALTER TABLE BATCH_STEP_EXECUTION DROP COLUMN CREATE_TIME;

-- Reverse the modification of START_TIME column
ALTER TABLE BATCH_STEP_EXECUTION ALTER COLUMN START_TIME SET NOT NULL;

-- Reverse the removal of DATE_VAL, LONG_VAL, and DOUBLE_VAL columns
ALTER TABLE BATCH_JOB_EXECUTION_PARAMS ADD COLUMN DATE_VAL TIMESTAMP;
ALTER TABLE BATCH_JOB_EXECUTION_PARAMS ADD COLUMN LONG_VAL BIGINT;
ALTER TABLE BATCH_JOB_EXECUTION_PARAMS ADD COLUMN DOUBLE_VAL DOUBLE PRECISION;

ALTER TABLE BATCH_JOB_EXECUTION_PARAMS RENAME PARAMETER_TYPE TO TYPE_CD;

-- Reverse the modifications and renaming of KEY_NAME to PARAMETER_NAME
ALTER TABLE BATCH_JOB_EXECUTION_PARAMS ALTER COLUMN PARAMETER_NAME TYPE VARCHAR(100);
ALTER TABLE BATCH_JOB_EXECUTION_PARAMS RENAME PARAMETER_NAME TO KEY_NAME;

-- Reverse the modifications and renaming of STRING_VAL to PARAMETER_VALUE
ALTER TABLE BATCH_JOB_EXECUTION_PARAMS ALTER COLUMN PARAMETER_VALUE TYPE VARCHAR(250);
ALTER TABLE BATCH_JOB_EXECUTION_PARAMS RENAME PARAMETER_VALUE TO STRING_VAL;

-- Reverse the dropping of JOB_CONFIGURATION_LOCATION column
ALTER TABLE BATCH_JOB_EXECUTION ADD COLUMN JOB_CONFIGURATION_LOCATION VARCHAR(2500);

-- Reverse the creation of indexes
DROP INDEX IF EXISTS idx_job_name;
DROP INDEX IF EXISTS idx_job_key;
